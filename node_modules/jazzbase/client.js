(function(){
    var ioQueue = [];
    var url = location.origin + ":1337/";

    function ajax(data, returns) {
        var jazzcript = new XMLHttpRequest();
        var query = [];
        
        var keys = Object.keys(data);
        var index = keys.length;

        while (index--) {
            if (keys[index] !== "returns") {
                query.push(keys[index] + "=" + data[keys[index]]);
            }
        }

        jazzcript.open("get", url + "?" + query.join("&"));
        jazzcript.onreadystatechange = function () {
            if (this.readyState == 4 && this.status == 200) {
                returns(this.responseText);
            }
        };

        jazzcript.send();
        
        return jazzcript;
    }
    
    function jazzbase(channel) {
        return {
            get: function (key, returns) {
                return ajax({channel:channel, key:key}, returns);
            },
            set: function (key, data, returns) {
                return ajax({channel:channel, key:key, data:data}, returns);
            }
        };
    }

    window.jazzbase = jazzbase;
})();